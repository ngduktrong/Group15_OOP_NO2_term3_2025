<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Quản lý tài khoản</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #333; }
        form, table { width: 100%; max-width: 600px; margin-bottom: 20px; }
        label { display: inline-block; width: 120px; vertical-align: top; }
        input, select { width: calc(100% - 130px); padding: 4px; }
        button { padding: 6px 12px; }
        table { border-collapse: collapse; }
        th, td { border: 1px solid #999; padding: 6px; text-align: center; }
        thead { background: #f0f0f0; }
        .actions form { display: inline; margin: 0; }
        .message { color: red; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>
<h1>Quản lý tài khoản</h1>

<div th:if="${message}" class="message">
    <p th:text="${message}"></p>
</div>

<h2 th:text="${editMode} ? 'Chỉnh sửa tài khoản' : 'Thêm tài khoản mới'"></h2>
<form th:action="${editMode} ? @{'/taikhoan/edit/' + ${taiKhoan.tenDangNhap}} : @{/taikhoan/add}"
      th:object="${taiKhoan}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <div>
        <label>Tên đăng nhập:</label>
        <input type="text" th:field="*{tenDangNhap}" th:readonly="${editMode}" required />
    </div>
    <div>
        <label>Mật khẩu:</label>
        <input type="password" th:field="*{matKhau}" required />
    </div>
    <div>
        <label>Loại tài khoản:</label>
        <select th:field="*{loaiTaiKhoan}">
            <option value="USER">USER</option>
            <option value="ADMIN">ADMIN</option>
        </select>
    </div>
    <div>
        <label>Mã người dùng:</label>
        <input type="number" th:field="*{maNguoiDung}" required />
    </div>
    <div style="margin-top:10px;">
        <button type="submit" th:text="${editMode} ? 'Cập nhật' : 'Thêm mới'"></button>
        <a th:if="${editMode}" th:href="@{/taikhoan}" style="margin-left:10px;">Hủy</a>
    </div>
</form>

<hr/>

<h2>Danh sách tài khoản</h2>
<table>
    <thead>
    <tr>
        <th>Username</th>
        <th>Password</th>
        <th>Loại TK</th>
        <th>Mã ND</th>
        <th>Hành động</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="tk : ${taiKhoans}">
        <td th:text="${tk.tenDangNhap}"></td>
        <td th:text="${tk.matKhau}"></td>
        <td th:text="${tk.loaiTaiKhoan}"></td>
        <td th:text="${tk.maNguoiDung}"></td>
        <td class="actions">
            <a th:href="@{|/taikhoan?edit=${tk.tenDangNhap}|}">Sửa</a>
            <form th:action="@{|/taikhoan/delete/${tk.tenDangNhap}|}" method="post"
                  onsubmit="return confirm('Bạn có chắc chắn muốn xóa?')">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit">Xóa</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>
</body>
</html>
